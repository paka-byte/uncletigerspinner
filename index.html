<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>FPL Tiger Lucky Draw</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    :root{
      --gap: 12px;
      --radius: 12px;
      --shadow: 0 4px 10px rgba(0,0,0,0.15);
      --btn-grad: linear-gradient(135deg,#ff914d,#ffb84d);
      --text:#111;
      --bg:#f6d2b8;
      --chip:#ffe5c2;
      --chip-border:#ff914d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin:0;
      padding:16px 16px calc(100px + env(safe-area-inset-bottom));
      -webkit-tap-highlight-color: transparent;
      overflow-x:hidden;
    }
    h1{ margin: 0 0 12px; font-size: clamp(20px, 5vw, 28px); text-align:center; }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï */
    .inputs{
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--gap);
      max-width: 720px;
      margin: 0 auto 10px;
      position: relative; z-index: 2;
    }
    .row{ display:flex; gap: var(--gap); }
    .row > *{ flex:1 }
    input, button{
      width:100%;
      padding: 12px 14px;
      font-size: 16px;
      border: none;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background:#fff;
      color:var(--text);
    }
    #addNameBtn{ white-space:nowrap; flex:0 0 auto; min-width: 120px; }

    /* ‡πÇ‡∏ã‡∏ô‡πÅ‡∏ó‡πà‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ vh) */
    .hero{
      position: relative;
      height: 68vh;              /* ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
      min-height: 320px;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 2;                /* ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πá‡∏Å */
    }
    .wheel-wrap{
      position: relative;
      width: min(92vw, 68vh);    /* ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á hero */
      aspect-ratio: 1/1;
      display:flex; align-items:center; justify-content:center;
    }
    canvas{
      border-radius: 50%;
      box-shadow: 0 6px 15px rgba(0,0,0,0.25);
      background: #fff;
      width: 100%;
      height: 100%;
    }
    .hide{ display:none }

    /* ‡∏•‡∏∏‡∏á‡πÄ‡∏™‡∏∑‡∏≠ (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏•‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏≤‡∏á) */
    #tigerLogo{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(100px + env(safe-area-inset-bottom)); /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏∏‡∏ô */
      width: clamp(84px, 22vw, 160px);
      cursor: pointer;
      z-index: 22;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.2));
    }
    .spin{ animation: spin 2s linear infinite; }
    @keyframes spin { from{transform:translateX(-50%) rotate(0)} to{transform:translateX(-50%) rotate(360deg)} }

    /* ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‡πÑ‡∏°‡πà‡∏î‡∏±‡∏ô hero */
    #nameList{
      margin: 8px auto 0;
      display:flex; flex-wrap:wrap; gap:8px; justify-content:center;
      max-width: 980px;
      max-height: 18vh;          /* ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏à‡∏≠ */
      overflow:auto;
      padding: 8px;
      z-index: 2; position: relative;
    }
    .name-tag{
      background: var(--chip);
      border: 1px solid var(--chip-border);
      border-radius: 18px;
      padding: 6px 12px;
      display:flex; align-items:center; gap:6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      font-size: 14px;
      white-space: nowrap;
    }
    .remove-btn{
      background:none; color:#c0392b; border:none;
      font-size:14px; cursor:pointer; padding:0 2px;
    }

    /* ‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πá‡∏Å ‡∏ß‡∏¥‡πà‡∏á‡∏ó‡∏±‡πà‡∏ß‡∏à‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏ó‡∏±‡∏ä) */
    .mini-tiger{
      position: fixed;
      width: 56px;
      border-radius: 50%;
      animation: spinMini 6s linear infinite;
      opacity: .85;
      pointer-events: none;
      will-change: left, top;
      z-index:1; /* ‡πÉ‡∏ï‡πâ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå */
    }
    @keyframes spinMini { from{transform:rotate(0)} to{transform:rotate(360deg)} }

    /* Popup */
    #winnerPopup{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,.25);
      opacity:0; pointer-events:none;
      transition: opacity .25s ease; z-index: 30;
      padding: 16px;
    }
    #winnerPopup.show{ opacity:1; pointer-events:auto; }
    .popup-card{
      background: var(--bg);
      border:2px solid #000;
      border-radius: 16px;
      padding: 22px 24px;
      text-align:center;
      box-shadow: 0 8px 20px rgba(0,0,0,.25);
      transform: scale(.92);
      animation: pop .3s ease forwards;
      max-width: 90vw;
    }
    @keyframes pop{ to{ transform: scale(1) } }
    .popup-card h2{ margin:0 0 10px; font-size: clamp(20px, 5vw, 28px); }
    .popup-card p{ margin:0 0 14px; font-size: clamp(16px, 4.5vw, 20px); }
    .popup-card button{
      background: var(--btn-grad);
      color:#fff; font-weight:700;
    }

    /* Placeholder ‡πÉ‡∏ô‡∏•‡πâ‡∏≠ */
    .placeholder{
      position:absolute; inset:0;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:8px; border-radius: 50%;
      color:#333; text-align:center;
    }
    .placeholder img{ width: 44px; height: 44px; animation: bounce 1.2s infinite; }
    @keyframes bounce{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏≠‡∏¢ */
    .floating-spin{
      position: fixed;
      left: 50%;
      bottom: calc(12px + env(safe-area-inset-bottom));
      transform: translateX(-50%);
      width: min(640px, 92vw);
      z-index: 25;
    }
    #spinBtn{
      background: var(--btn-grad);
      color:#fff; font-weight:700;
      padding: 14px 16px;
      font-size: clamp(16px, 5vw, 18px);
      width:100%;
      border-radius: 999px;
      box-shadow: 0 8px 16px rgba(255,145,77,.35);
    }
    #spinBtn:active{ transform: scale(.98); }

    /* ‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà hero */
    @media (min-width: 900px){
      .hero{ height: 72vh; }
      #nameList{ max-height: 20vh; }
    }
  </style>
</head>
<body>
  <h1>üéÅ Lucky Draw ‚Äî FPL Tiger</h1>

  <!-- ‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï -->
  <div class="inputs">
    <input type="file" id="fileInput" accept=".csv,.xlsx" />
    <input type="text" id="prizeInput" placeholder="‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?" />
    <div class="row">
      <input type="text" id="nameInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ Enter" />
      <button id="addNameBtn" type="button" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠</button>
    </div>
  </div>

  <!-- ‡πÅ‡∏ó‡πà‡∏ô‡∏´‡∏°‡∏∏‡∏ô (‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô) -->
  <section class="hero">
    <div class="wheel-wrap">
      <canvas id="wheelCanvas" class="hide"></canvas>
      <div id="placeholder" class="placeholder">
        <img src="images/logo.png" alt="Tiger" />
        <div>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏±‡πà‡∏ô!</div>
      </div>
    </div>
  </section>

  <!-- ‡∏•‡∏∏‡∏á‡πÄ‡∏™‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏≤‡∏á (‡∏Å‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏∏‡∏ô) -->
  <img src="images/logo.png" alt="FPL Tiger" id="tigerLogo" />

  <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á) -->
  <div id="nameList"></div>

  <!-- Popup -->
  <div id="winnerPopup">
    <div class="popup-card">
      <h2>üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! üéâ</h2>
      <p id="winnerText"></p>
      <button onclick="closePopup()">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏∏‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏≠‡∏¢ -->
  <div class="floating-spin">
    <button id="spinBtn">üêØ ‡∏Å‡∏î‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏±‡πà‡∏ô!</button>
  </div>

  <!-- ‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πá‡∏Å 7 ‡∏ï‡∏±‡∏ß -->
  <img src="images/logo.png" class="mini-tiger" alt="">
  <img src="images/logo.png" class="mini-tiger" alt="">
  <img src="images/logo.png" class="mini-tiger" alt="">
  <img src="images/logo.png" class="mini-tiger" alt="">
  <img src="images/logo.png" class="mini-tiger" alt="">
  <img src="images/logo.png" class="mini-tiger" alt="">
  <img src="images/logo.png" class="mini-tiger" alt="">

  <!-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
  <audio id="spinSound" src="sounds/spin.mp3" preload="auto"></audio>
  <audio id="winSound"  src="sounds/win.mp3"  preload="auto"></audio>

<script>
/* ---------- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏Å ---------- */
let names = [];
let startAngle = 0;
let arc = 0;
let isSpinning = false;
let spinDuration = 8000; // 8 ‡∏ß‡∏¥
let startTime;

const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");
const nameList = document.getElementById("nameList");
const placeholder = document.getElementById("placeholder");
const tigerLogo = document.getElementById("tigerLogo");

/* ---------- ‡∏•‡πâ‡∏≠: ‡∏Ç‡∏ô‡∏≤‡∏î Responsive + ‡∏Ñ‡∏°‡∏ö‡∏ô Retina ---------- */
let wheelSize = 400;
function setCanvasSize(){
  const dpr = window.devicePixelRatio || 1;
  const wrap = document.querySelector(".wheel-wrap");
  const wrapPx = wrap.getBoundingClientRect().width || Math.min(window.innerWidth*0.9, 420);
  wheelSize = Math.round(Math.min(520, wrapPx));  // ‡πÄ‡∏û‡∏î‡∏≤‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢
  canvas.style.width = wheelSize + "px";
  canvas.style.height = wheelSize + "px";
  canvas.width  = Math.floor(wheelSize * dpr);
  canvas.height = Math.floor(wheelSize * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
  drawRouletteWheel();
}

/* ---------- ‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πá‡∏Å: ‡∏™‡∏õ‡∏¥‡∏ô + ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏≠‡∏ö ---------- */
const tigers = Array.from(document.querySelectorAll(".mini-tiger"));
tigers.forEach(t => {
  const speed = (Math.random() * 6 + 4).toFixed(1);
  t.style.animationDuration = `${speed}s`;
});
const BASE_SPEED_MIN = 40, BASE_SPEED_MAX = 100;
const tigerState = tigers.map(t => {
  const w = t.getBoundingClientRect().width || 56, h = w;
  const x = Math.random() * Math.max(1, window.innerWidth  - w);
  const y = Math.random() * Math.max(1, window.innerHeight - h);
  const ang = Math.random() * Math.PI * 2;
  const spd = Math.random() * (BASE_SPEED_MAX-BASE_SPEED_MIN) + BASE_SPEED_MIN;
  const vx = Math.cos(ang) * spd, vy = Math.sin(ang) * spd;
  t.style.left = x + "px"; t.style.top = y + "px";
  return { el:t, x, y, vx, vy, w, h };
});
let lastTs = null;
function animateTigers(ts){
  if(lastTs === null) lastTs = ts;
  const dt = (ts - lastTs)/1000; lastTs = ts;
  const W = window.innerWidth, H = window.innerHeight;
  tigerState.forEach(s=>{
    s.x += s.vx*dt; s.y += s.vy*dt;
    if(s.x <= 0){ s.x=0; s.vx = Math.abs(s.vx); }
    if(s.x >= W - s.w){ s.x = W - s.w; s.vx = -Math.abs(s.vx); }
    if(s.y <= 0){ s.y=0; s.vy = Math.abs(s.vy); }
    if(s.y >= H - s.h){ s.y = H - s.h; s.vy = -Math.abs(s.vy); }
    s.el.style.left = s.x + "px"; s.el.style.top = s.y + "px";
  });
  requestAnimationFrame(animateTigers);
}
requestAnimationFrame(animateTigers);
window.addEventListener("resize", ()=>{
  setCanvasSize();
  const W = window.innerWidth, H = window.innerHeight;
  tigerState.forEach(s=>{
    s.x = Math.min(Math.max(0,s.x), Math.max(0, W-s.w));
    s.y = Math.min(Math.max(0,s.y), Math.max(0, H-s.h));
    s.el.style.left = s.x + "px"; s.el.style.top = s.y + "px";
  });
});

/* ---------- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ ---------- */
function renderNameList(){
  nameList.innerHTML = "";
  names.forEach((n,i)=>{
    const tag = document.createElement("div");
    tag.className = "name-tag";
    tag.innerHTML = `${n} <button class="remove-btn" data-index="${i}" aria-label="‡∏•‡∏ö">‚úñ</button>`;
    nameList.appendChild(tag);
  });
  document.querySelectorAll(".remove-btn").forEach(btn=>{
    btn.addEventListener("click", e=>{
      const idx = Number(e.currentTarget.getAttribute("data-index"));
      names.splice(idx,1);
      arc = names.length>0 ? Math.PI*2/names.length : 0;
      drawRouletteWheel(); renderNameList();
    });
  });
  if(names.length === 0){ placeholder.classList.remove("hide"); canvas.classList.add("hide"); }
  else{ placeholder.classList.add("hide"); canvas.classList.remove("hide"); }
}

/* ---------- ‡∏ß‡∏≤‡∏î‡∏•‡πâ‡∏≠ ---------- */
function drawRouletteWheel() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(names.length === 0) return;

  const size = wheelSize;
  const cx = size/2, cy = size/2;
  const outsideRadius = size * 0.45;
  const textRadius    = size * 0.35;
  const insideRadius  = size * 0.125;

  ctx.strokeStyle = "#000";
  ctx.lineWidth = Math.max(1, size*0.005);
  ctx.font = `${Math.max(12, size*0.04)}px Segoe UI`;

  for(let i=0;i<names.length;i++){
    const angle = startAngle + i*arc;
    ctx.fillStyle = i%2===0 ? "#ffcc80" : "#ffb74d";

    ctx.beginPath();
    ctx.arc(cx, cy, outsideRadius, angle, angle+arc, false);
    ctx.arc(cx, cy, insideRadius,  angle+arc, angle, true);
    ctx.fill(); ctx.stroke();

    ctx.save();
    ctx.fillStyle = "#000";
    ctx.translate(
      cx + Math.cos(angle + arc/2) * textRadius,
      cy + Math.sin(angle + arc/2) * textRadius
    );
    ctx.rotate(angle + arc/2);
    const text = names[i];
    ctx.fillText(text, -ctx.measureText(text).width/2, 0);
    ctx.restore();
  }

  // ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á
  const img = new Image();
  img.src = "images/logo.png";
  img.onload = ()=>{
    ctx.save();
    ctx.beginPath();
    ctx.arc(cx, cy, insideRadius, 0, Math.PI*2);
    ctx.clip();
    const s = insideRadius*2*0.9;
    ctx.drawImage(img, cx - s/2, cy - s/2, s, s);
    ctx.restore();
  };

  // Marker ‡∏ö‡∏ô
  ctx.fillStyle = "#000";
  const triW = size * 0.06, triH = size * 0.07, top = size * 0.02;
  ctx.beginPath();
  ctx.moveTo(cx - triW/2, top);
  ctx.lineTo(cx + triW/2, top);
  ctx.lineTo(cx, top + triH);
  ctx.closePath();
  ctx.fill();
}

/* ---------- ‡∏´‡∏°‡∏∏‡∏ô ---------- */
function rotateWheel(ts){
  if(!startTime) startTime = ts;
  const elapsed = ts - startTime;
  const progress = Math.min(1, elapsed / spinDuration);
  const easeOut = Math.pow(1 - progress, 3);
  const spinAngleDelta = easeOut * 20;
  startAngle += (spinAngleDelta * Math.PI / 180);
  drawRouletteWheel();
  if(elapsed < spinDuration) requestAnimationFrame(rotateWheel);
  else stopRotateWheel();
}
function stopRotateWheel(){
  isSpinning = false;
  const degrees = startAngle * 180/Math.PI + 90;
  const arcd = arc * 180/Math.PI;
  const index = Math.floor((360 - degrees % 360) / arcd) % names.length;
  const winner = names[index];

  const spinS = document.getElementById("spinSound");
  const winS  = document.getElementById("winSound");
  try{ spinS.pause(); }catch(e){}
  winS.currentTime = 0; winS.play().catch(()=>{});

  tigerLogo.classList.remove("spin");
  const prize = document.getElementById("prizeInput").value || "‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏û‡∏¥‡πÄ‡∏®‡∏©";
  document.getElementById("winnerText").innerHTML = `‡∏Ñ‡∏∏‡∏ì <b>${winner}</b> ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• <b>${prize}</b> üèÜ`;
  document.getElementById("winnerPopup").classList.add("show");
}
function closePopup(){ document.getElementById("winnerPopup").classList.remove("show"); }

/* ---------- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠ ---------- */
function addName(val){
  val = (val||"").trim();
  if(!val) return;
  names.push(val);
  arc = Math.PI*2 / names.length;
  drawRouletteWheel(); renderNameList();
}
function addNameFromInput(){
  const el = document.getElementById("nameInput");
  addName(el.value); el.value = "";
}

/* ---------- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠: ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ---------- */
function unlockAudio(){
  const a1 = document.getElementById("spinSound");
  const a2 = document.getElementById("winSound");
  [a1,a2].forEach(a=>{
    a.muted = true;
    a.play().then(()=>{ a.pause(); a.currentTime=0; a.muted=false; }).catch(()=>{});
  });
  document.removeEventListener("touchstart", unlockAudio);
  document.removeEventListener("mousedown", unlockAudio);
}
document.addEventListener("touchstart", unlockAudio, {once:true});
document.addEventListener("mousedown", unlockAudio, {once:true});

/* ---------- Tap-friendly ---------- */
function bindTap(el, handler){
  el.addEventListener("click", (e)=>{ e.preventDefault(); handler(); });
  el.addEventListener("touchend", (e)=>{ e.preventDefault(); handler(); }, { passive:false });
}
bindTap(document.getElementById("spinBtn"), startSpin);
bindTap(tigerLogo, startSpin);
bindTap(document.getElementById("addNameBtn"), addNameFromInput);

function startSpin(){
  if(isSpinning || names.length===0){
    if(names.length===0) alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏±‡πà‡∏ô!");
    return;
  }
  isSpinning = true; startTime = null;
  const spinS = document.getElementById("spinSound");
  try{ spinS.currentTime=0; spinS.play().catch(()=>{}); }catch(e){}
  // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏∏‡∏á‡πÄ‡∏™‡∏∑‡∏≠‡∏´‡∏°‡∏∏‡∏ô
  tigerLogo.classList.add("spin");
  requestAnimationFrame(rotateWheel);
}

/* ---------- ‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï/‡πÑ‡∏ü‡∏•‡πå ---------- */
document.getElementById("nameInput").addEventListener("keydown", e=>{
  if(e.code==="Enter"){ e.preventDefault(); addNameFromInput(); }
});
document.getElementById("fileInput").addEventListener("change", (e)=>{
  const file = e.target.files[0]; if(!file) return;
  Papa.parse(file, {
    complete: function(results){
      names = results.data.flat().map(x=>String(x).trim()).filter(Boolean);
      arc = names.length>0 ? Math.PI*2/names.length : 0;
      drawRouletteWheel(); renderNameList();
    }
  });
});

/* ---------- ‡πÄ‡∏£‡∏¥‡πà‡∏° ---------- */
setCanvasSize();
renderNameList();
window.addEventListener("resize", setCanvasSize);
</script>
</body>
</html>
